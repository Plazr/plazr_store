<article id="product-show">

  <header class="row-fluid">
    <div class="span7">
      <h2><%= @product.name %></h2>
      <p><%= @product.rating %></p>
    </div>
    <div class="span5">
      <h2 id="price"><%= @variant.price %> €</h2>
    </div>
  </header>


  <div class="row-fluid">
    <div class="span6">

        <div id="page-wrap">
          <div class="slider-wrap">
            <div id="main-photo-slider" class="csw">
              <div class="panelContainer">
                
                <% @product.images.each_with_index do |im, index| %>
                  <div class="panel" title='Panel <%=index + 1 %>'>
                    <div class="wrapper">
                      <img src=<%=im.file%> alt="temp" />
                    </div>
                  </div>
                <% end %>
              </div>
            </div>

            <div id="movers-row">
              
              <% @product.images.each_with_index do |im, index| %>
                <div><a href="#<%=index + 1 %>" class="cross-link"><img src=<%=im.file%> class="nav-thumb" alt="temp-thumb" /></a></div>
              <% end %>
              
            </div>
          </div>
        </div>
      </div>
      <!--Descrição do variante e do product-->
      <div class="span3">
        <dl>
          <dt>Detalhes</dt>
          <dd><%= @product.details %></dd>
          <% if @product.brand %>
          <dt>Marca</dt>
          <dd><%= @product.brand.name %></dd>
          <% end %>
          <dt>Referência<dt>
          <dd><%= @variant.sku %></dd>
          <% if @variant.description %>
            <dt>Descrição<dt>
            <dd><%= @variant.description %></dd>
          <% end %>
        </dl>

        
        <% if !@product.variants_without_master.empty?%>
          <dl>
            <dt>Variantes:</dt>
          </dl>
          <select>
            <% @product.variants_without_master.each_with_index do |v, index| %>
               <option id=<%= v.id %> value=<%= v.price %> ><%= v.variant_properties_values %></option>
             <% end %>
          </select>
        <% end %>

        <dl>
          <dt>Quantidade:</dt>
        </dl>
        <%= add_to_cart_form(@variant.id) %>
        <%= add_to_wishlist_form(@variant.id) %>
      </div>

      <div class="span3">
            <ul>
              <li><a id="add_cart_bt" class="btn btn-large btn-primary disabled">Add Cart</a></li>
              <li><a id="add_wishlist_bt" class="btn btn-large btn-primary disabled">Add Wishlist</a></li>
              <li><a class="btn btn-large btn-primary disabled">Add comment</a></li>
            </ul>
          <!--
          <ul>
            <a href="#" class="btn btn-large btn-primary disabled">Share facebook</a>
            <a href="#" class="btn btn-large btn-primary disabled">Share twiter</a>
            <a href="#" class="btn btn-large btn-primary disabled">Share google</a>
          </ul>
        -->
      </div>

    </div>

    <% if @product.related.size > 0 %>
      <section>

        <div>
          <div class="row">
            <div class="span9" align="center">
              <h3>Artigos relacionados</h3>
            </div>
          </div>

          <!--Não consigo validar porque a base de dados nao esta povoada-->
            <div class="row">
              <% @product.related.each do |product| %>
                <%= render 'plazr_store/shared/thumb-item', recommended: product %>
              <% end %>
            </div>

        </div>
      </section>
    <%end%>

    <% if !@product.comments.empty? %>
    <section>
      <div class="row-fluid">
        <div class="span11">
          <h1>Comentários</h1>
        </div>
      </div>

      <% @product.comments.each do |c| %>
      <div class="row-fluid">
        <div class="span4">
          <h3>Nome</h3>
          <p><%= PlazrAuth::User.find(@product.id).first_name %></p>
          <p><%= c.rating %></p>
        </div>

        <div class="span5">
          <p><%= c.comment %></p>
        </div>
      </div>
      <% end %>
    </section>
    <% end %>
  </article>

<script>
  $(document).ready(function() {
    $('#product-show select').change(function(){
      var price = $(this).val();

      $('#product-show #price').text(price + " €");

      var id = $(this).attr('id');

      $("#add_cart_f").attr("action","/cart/add/" + id);
      $("#add_wishlist_f").attr("action","/wishlist/add/" + id);
    });

    $("#add_cart_bt").click(function(){
      if(parseInt($("#add_cart_f #amount").val())>0){
        alert("Adicionado ao carrinho");
        $("#add_cart_f").submit();
      } 
      else alert("Quantidade inferior a 0.");
    });

    $("#add_wishlist_bt").click(function(){
      alert("Adicionado à wishlist");
      $("#add_wishlist_f").submit();
    });

  });
</script>
